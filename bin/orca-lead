#!/usr/bin/env coffee
[_, _, path] = process.argv

{read, log} = require "fairmont"
{parse} = require "cson"

optimist = require("optimist")
  .demand("configuration")
  .alias("configuration", "c")
  .describe("configuration", "Path to CSON configuration file")

  .demand("test")
  .alias("test", "t")
  .describe("test", "Path to CSON file specifying the load test")

argv = optimist.argv

Environment = require "../src/environment"

try
  configuration = parse read argv.configuration
  environment = new Environment(configuration)
  test = parse read argv.test
  log test
catch error
  log "Error processing configuration file"
  log error
  process.exit -1


Lead = require "../src/lead"
lead = new Lead(environment, test)
lead.run()
